HA$PBExportHeader$w_r_recolte_commande.srw
forward
global type w_r_recolte_commande from w_rapport
end type
end forward

global type w_r_recolte_commande from w_rapport
string title = "Rapport - Gestion des r$$HEX1$$e900$$ENDHEX$$coltes en comparaison avec les commandes"
end type
global w_r_recolte_commande w_r_recolte_commande

on w_r_recolte_commande.create
call super::create
end on

on w_r_recolte_commande.destroy
call super::destroy
if IsValid(MenuID) then destroy(MenuID)
end on

event pfc_preopen;call super::pfc_preopen;string	ls_date

ls_date = gnv_app.inv_entrepotglobal.of_retournedonnee("lien rapport recolte commande date")

dw_preview.retrieve(date(ls_date))

IF gnv_app.of_getcompagniedefaut( ) = "111" or gnv_app.of_getcompagniedefaut( ) = "112" THEN 
	dw_preview.Object.t_recolte_commande_qteverraterie.visible = false
	dw_preview.Object.t_3.visible = false
	dw_preview.Object.t_recolte_commande_qtesoldearecolter.visible = false
	dw_preview.Object.t_7.visible = false	
	dw_preview.Object.compute_2.visible = false	
	dw_preview.Object.compute_8.visible = false	
	dw_preview.Object.compute_6.visible = false	
	dw_preview.Object.compute_12.visible = false	
END IF


end event

event pfc_postopen;call super::pfc_postopen;string ls_nom_fichier, ls_cie, ls_repexport, ls_exp_rap

// Si on veut exporter les rapports de r$$HEX1$$e900$$ENDHEX$$coltes en comparaison avec les commandes
ls_exp_rap = gnv_app.of_getvaleurini("TRANSFERT", "Export_Rap")
if upper(ls_exp_rap) = 'TRUE' then
	//V$$HEX1$$e900$$ENDHEX$$rifier le r$$HEX1$$e900$$ENDHEX$$pertoire d'exportation
	ls_repexport = gnv_app.of_getvaleurini("FTP", "EXPORTPATH")
	IF LEN(ls_repexport) > 0 THEN
		IF NOT FileExists(ls_repexport) THEN
			gnv_app.inv_error.of_message("CIPQ0139")
			RETURN
		END IF
	ELSE
		gnv_app.inv_error.of_message("CIPQ0140")
		RETURN
	END IF
	IF RIGHT(ls_repexport, 1) <> "\" THEN ls_repexport += "\"
	
	ls_cie = gnv_app.of_getcompagniedefaut()
	
	ls_nom_fichier = "110P" + ls_cie + '-' + string(today(), "yyyy-mm-dd") + string(now(), " hh-mm-ss") + ".pdf"
	
	dw_preview.saveAs(ls_repexport + ls_nom_fichier, PDF!, false)
end if

// 2010-03-16 - S$$HEX1$$e900$$ENDHEX$$bastien - Ne pas quitter, laisser la fen$$HEX1$$ea00$$ENDHEX$$tre ouverte

//string	ls_cie
//long		ll_nbligne
//
//ls_cie = gnv_app.of_getcompagniedefaut( )
//ll_nbligne = dw_preview.rowcount()
//
//do while yield()
//loop
//
//IF ls_cie <> "112" THEN
//	IF ll_nbligne > 0 THEN
//		dw_preview.print(false,false)
//		do while yield()
//		loop
//		close(this)
//	ELSE
//		MEssagebox("Attention", "Il n'y a rien $$HEX2$$e0002000$$ENDHEX$$imprimer")
//	END IF
//END IF
end event

type dw_preview from w_rapport`dw_preview within w_r_recolte_commande
string dataobject = "d_r_recolte_commande"
boolean border = false
end type

